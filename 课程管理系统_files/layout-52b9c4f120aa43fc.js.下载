(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{109:(e,t,r)=>{"use strict";r.d(t,{OO:()=>c,SF:()=>l});var n=r(5155),a=r(2115),s=r(9959),i=r(283);let o=(0,a.createContext)(void 0);function l(e){let{children:t}=e,[r,l]=(0,a.useState)(null),[c,d]=(0,a.useState)(!0),{user:m}=(0,i.A)(),u=async()=>{var e;if(!m||(null===(e=m.data)||void 0===e?void 0:e.type)!==4){d(!1),l(null);return}try{d(!0);let e=await s.y.getStudentSalesInfo();200===e.code&&e.data?l(e.data):l(null)}catch(e){console.error("获取销售信息失败:",e),l(null)}finally{d(!1)}},h=async e=>{try{d(!0);let t=await s.y.updateStudentSalesInfo(e);if(200===t.code)return await u(),!0;return!1}catch(e){return console.error("更新销售信息失败:",e),!1}finally{d(!1)}};return(0,a.useEffect)(()=>{u()},[m]),(0,n.jsx)(o.Provider,{value:{salesInfo:r,isLoading:c,updateSalesInfo:h,refreshSalesInfo:u},children:t})}function c(){let e=(0,a.useContext)(o);if(void 0===e)throw Error("useSalesInfo must be used within a SalesInfoProvider");return e}},283:(e,t,r)=>{"use strict";r.d(t,{A:()=>u,O:()=>m});var n=r(5155),a=r(2115),s=r(5695),i=r(9385),o=r(9959),l=r(8508);let c=(0,a.createContext)(void 0),d={ADMIN:{id:"admin",name:"管理员",permissions:[i.J.VIEW_WARNINGS,i.J.VIEW_SCHEDULE,i.J.VIEW_LESSON_TABLE,i.J.VIEW_CARD,i.J.FILE_COMPLAINT,i.J.EDIT_PROFILE,i.J.VIEW_BOOK_LOCKER,i.J.VIEW_PASTPAPER_TEXTBOOKS,i.J.VIEW_WEEKEND_PLAN,i.J.VIEW_CERTIFICATE_APPLY,i.J.VIEW_EXIT_PERMIT,i.J.VIEW_CLASS_SIGNUP,i.J.VIEW_SERVICE,i.J.VIEW_LATE_CASHIN,i.J.VIEW_REMARKING,i.J.VIEW_EXAM_WITHDRAWAL,i.J.VIEW_SCORE_REPORT,i.J.VIEW_TEXTBOOK,i.J.VIEW_NOTIFICATION,i.J.VIEW_EXAM_SIGNUP,i.J.VIEW_COMMITMENT]},TEACHER:{id:"teacher",name:"教师",permissions:[i.J.VIEW_WARNINGS,i.J.VIEW_SCHEDULE,i.J.VIEW_LESSON_TABLE,i.J.VIEW_CARD,i.J.FILE_COMPLAINT,i.J.EDIT_PROFILE,i.J.VIEW_BOOK_LOCKER,i.J.VIEW_PASTPAPER_TEXTBOOKS,i.J.VIEW_WEEKEND_PLAN,i.J.VIEW_CERTIFICATE_APPLY,i.J.VIEW_EXIT_PERMIT,i.J.VIEW_CLASS_SIGNUP,i.J.VIEW_SERVICE,i.J.VIEW_LATE_CASHIN,i.J.VIEW_REMARKING,i.J.VIEW_EXAM_WITHDRAWAL,i.J.VIEW_SCORE_REPORT,i.J.VIEW_TEXTBOOK,i.J.VIEW_NOTIFICATION,i.J.VIEW_EXAM_SIGNUP,i.J.VIEW_COMMITMENT]},STUDENT:{id:"student",name:"学生",permissions:[i.J.VIEW_SCHEDULE,i.J.VIEW_LESSON_TABLE,i.J.VIEW_WARNINGS,i.J.VIEW_CARD,i.J.FILE_COMPLAINT,i.J.EDIT_PROFILE,i.J.VIEW_BOOK_LOCKER,i.J.VIEW_PASTPAPER_TEXTBOOKS,i.J.VIEW_WEEKEND_PLAN,i.J.VIEW_CERTIFICATE_APPLY,i.J.VIEW_EXIT_PERMIT,i.J.VIEW_CLASS_SIGNUP,i.J.VIEW_SERVICE,i.J.VIEW_LATE_CASHIN,i.J.VIEW_REMARKING,i.J.VIEW_EXAM_WITHDRAWAL,i.J.VIEW_SCORE_REPORT,i.J.VIEW_TEXTBOOK,i.J.VIEW_NOTIFICATION,i.J.VIEW_EXAM_SIGNUP,i.J.VIEW_COMMITMENT]},PRE_STUDENT:{id:"pre_student",name:"报名学生",permissions:[i.J.INTERVIEW,i.J.MY_PROFILE,i.J.TEST_SCORE,i.J.MY_TEST,i.J.INTERVIEW]}};function m(e){let{children:t}=e,[i,m]=(0,a.useState)(null),[u,h]=(0,a.useState)(!0),E=(0,s.useRouter)();(0,a.useEffect)(()=>{!async function(){try{h(!0);let e=await o.y.getUserInfo();if(200===e.code&&e.data){let t=e.data,r={id:"unknown",name:"未知",permissions:[]};1===t.type?r=d.STUDENT:4===t.type&&(r=d.PRE_STUDENT);let n={id:String(t.id),username:String(t.name),role:r,data:t};m(n),localStorage.setItem("user",JSON.stringify(n))}else m(null),localStorage.removeItem("user"),localStorage.removeItem("token"),E.push("/login")}catch(e){console.error("检查登录状态失败:",e),m(null),localStorage.removeItem("user"),localStorage.removeItem("token"),E.push("/login")}finally{h(!1)}}()},[E]);let p=async(e,t)=>{try{let r=await o.y.login({username:e,password:t});if(200!==r.code||!r.token)throw Error(r.message||"登录失败");r.token&&localStorage.setItem("token",r.token);let n=(await o.y.getUserInfo()).data,a={id:"unknown",name:"未知",permissions:[]};1===n.type?a=d.STUDENT:4===n.type&&(a=d.PRE_STUDENT);let s={id:String(n.id),username:n.name,role:a,data:n};m(s),localStorage.setItem("user",JSON.stringify(s)),await (0,l.iO)(n,E)}catch(e){throw console.error("登录失败:",e),e}},x=async()=>{try{let e=await o.y.logout();if(200!==e.code)throw Error(e.message||"退出失败")}catch(e){console.error("退出异常:",e)}finally{m(null),localStorage.removeItem("user"),localStorage.removeItem("token");let{notifyMiniProgramLogout:e}=await r.e(48).then(r.bind(r,4048));e(),setTimeout(()=>{E.push("/login")},0)}};return(0,n.jsx)(c.Provider,{value:{user:i,login:p,logout:x,hasPermission:e=>!!i&&i.role.permissions.includes(e)},children:u?(0,n.jsx)("div",{children:"加载中..."}):t})}function u(){let e=(0,a.useContext)(c);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},347:()=>{},2459:(e,t,r)=>{"use strict";r.d(t,{X:()=>i,l:()=>o});var n=r(5155),a=r(2115);let s=(0,a.createContext)(void 0);function i(e){let{children:t}=e,[r,i]=(0,a.useState)([]),o=(0,a.useCallback)(e=>{i(t=>t.filter(t=>t.id!==e))},[]),c=(0,a.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5e3,n=Math.random().toString(36).substring(2,9),a={id:n,message:e,type:t,duration:r};i(e=>[...e,a]),r>0&&setTimeout(()=>{o(n)},r)},[o]);return(0,n.jsxs)(s.Provider,{value:{notifications:r,notify:c,removeNotification:o},children:[t,(0,n.jsx)(l,{})]})}function o(){let e=(0,a.useContext)(s);if(void 0===e)throw Error("useNotify must be used within a NotifyProvider");return e}function l(){let{notifications:e,removeNotification:t}=o();return(0,n.jsx)("div",{className:"fixed top-4 right-4 z-50 flex flex-col gap-2 max-w-md",children:e.map(e=>(0,n.jsx)(c,{notification:e,onClose:()=>t(e.id)},e.id))})}function c(e){let{notification:t,onClose:r}=e,[s,i]=(0,a.useState)(!1);return(0,a.useEffect)(()=>{if(t.duration>0){let e=setTimeout(()=>{i(!0),setTimeout(r,300)},t.duration-300);return()=>clearTimeout(e)}},[t.duration,r]),(0,n.jsxs)("div",{className:"relative p-4 rounded-md shadow-md border-l-4 min-w-[280px] transform transition-all duration-300 ".concat((()=>{switch(t.type){case"success":return"bg-green-100 border-green-500 text-green-700";case"warning":return"bg-yellow-100 border-yellow-500 text-yellow-700";case"error":return"bg-red-100 border-red-500 text-red-700";default:return"bg-blue-100 border-blue-500 text-blue-700"}})()," ").concat(s?"opacity-0 translate-x-full":"opacity-100"),children:[(0,n.jsx)("button",{onClick:()=>{i(!0),setTimeout(()=>{r()},300)},className:"absolute top-2 right-2 text-gray-500 hover:text-gray-700","aria-label":"关闭",children:(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),(0,n.jsx)("div",{className:"pr-5",children:t.message})]})}},5097:(e,t,r)=>{Promise.resolve().then(r.bind(r,7133))},7133:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>F});var n=r(5155);r(347);var a=r(2115),s=r(5695),i=r(283),o=r(9385),l=r(8828),c=r(4038),d=r(2975),m=r(4219),u=r(5500),h=r(9994),E=r(8688),p=r(5442),x=r(5596),_=r(710),I=r(2227),f=r(6124),g=r(2175),b=r(7248),v=r(4648),N=r(1174),y=r(1316),w=r(4500),T=r(4170),S=r(5628),A=r(2278),W=r(192),j=r(9598),C=r(6331),O=r(3418);let J=[{name:"My Notification",href:"/notification",icon:l.A,permission:o.J.VIEW_NOTIFICATION},{name:"My Profile",href:"/my-profile",icon:c.A,permission:o.J.MY_PROFILE},{name:"My Test",href:"/my-test",icon:d.A,permission:o.J.MY_TEST},{name:"Interview",href:"/interview",icon:m.A,permission:o.J.INTERVIEW},{name:"Test Score",href:"/test-score",icon:u.A,permission:o.J.TEST_SCORE},{name:"School Life",icon:h.A,children:[{name:"Book Service",href:"/service",icon:E.A,permission:o.J.VIEW_SERVICE},{name:"Book Locker",href:"/book-locker",icon:p.A,permission:o.J.VIEW_BOOK_LOCKER},{name:"Exit Permit",href:"/exit-permit",icon:x.A,permission:o.J.VIEW_EXIT_PERMIT},{name:"My Card",href:"/card",icon:_.A,permission:o.J.VIEW_CARD},{name:"Weekend Plan",href:"/weekend-plan",icon:I.A,permission:o.J.VIEW_WEEKEND_PLAN}]},{name:"Schedule",icon:I.A,children:[{name:"Schedule",href:"/schedule",icon:I.A,permission:o.J.VIEW_SCHEDULE},{name:"Lesson Table",href:"/lesson-table",icon:f.A,permission:o.J.VIEW_LESSON_TABLE},{name:"Class Signup",href:"/class-signup",icon:g.A,permission:o.J.VIEW_CLASS_SIGNUP}]},{name:"Library",icon:b.A,children:[{name:"Buy Textbook",href:"/textbook",icon:b.A,permission:o.J.VIEW_TEXTBOOK},{name:"Resources",href:"/pastpaper-textbooks",icon:d.A,permission:o.J.VIEW_PASTPAPER_TEXTBOOKS}]},{name:"Exam",icon:v.A,children:[{name:"Exam Signup",href:"/exam-signup",icon:d.A,permission:o.J.VIEW_EXAM_SIGNUP},{name:"Score Report",href:"/score-report",icon:u.A,permission:o.J.VIEW_SCORE_REPORT},{name:"Late Cashin",href:"/late-cashin",icon:N.A,permission:o.J.VIEW_LATE_CASHIN},{name:"Remarking",href:"/remarking",icon:y.A,permission:o.J.VIEW_REMARKING},{name:"Exam Withdrawal",href:"/exam-withdrawal",icon:w.A,permission:o.J.VIEW_EXAM_WITHDRAWAL}]},{name:"My Account",icon:T.A,children:[{name:"My Warning",href:"/student-warn",icon:S.A,permission:o.J.VIEW_WARNINGS},{name:"Edit Profile",href:"/profile",icon:c.A,permission:o.J.EDIT_PROFILE},{name:"Certificate Apply",href:"/certificate-apply",icon:A.A,permission:o.J.VIEW_CERTIFICATE_APPLY},{name:"File Complaint",href:"/complaint",icon:W.A,permission:o.J.FILE_COMPLAINT},{name:"Commitment",href:"/commitment",icon:d.A,permission:o.J.VIEW_COMMITMENT}]}];function V(e){let{children:t}=e,r=(0,s.useRouter)(),o=(0,s.usePathname)(),[l,c]=(0,a.useState)(!1),[d,m]=(0,a.useState)(null),{logout:u,hasPermission:h,user:E}=(0,i.A)(),p=(0,a.useRef)(!0);(0,a.useEffect)(()=>{c(!(window.innerWidth<768));let e=()=>{window.innerWidth>=768?c(!0):c(!1)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);let x=async()=>{try{await u()}catch(e){console.error("退出失败:",e)}},_=e=>{var t;return e.href?o===e.href:(null===(t=e.children)||void 0===t?void 0:t.some(e=>o===e.href))||!1},I=e=>o===e,f=e=>{m(d===e?null:e)},g=J.filter(e=>{if(e.children&&e.children.length>0){let t=e.children.filter(e=>!e.permission||h(e.permission));return t.length>0&&(e.children=t,!0)}return!e.permission||h(e.permission)});return(0,a.useEffect)(()=>{if(p.current){let e=g.find(e=>{var t;return null===(t=e.children)||void 0===t?void 0:t.some(e=>o===e.href)});e&&m(e.name),p.current=!1}},[o,g]),(0,n.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,n.jsx)("div",{className:"sticky top-0 z-30 shadow-sm",style:{background:"var(--header-bg)"},children:(0,n.jsxs)("div",{className:"flex h-16 items-center justify-between px-6",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("button",{className:"md:hidden mr-2 text-white",onClick:()=>c(!l),"aria-label":"菜单",children:(0,n.jsx)(j.A,{className:"h-6 w-6"})}),(0,n.jsx)("div",{className:"flex flex-shrink-0 items-center",children:(0,n.jsx)("img",{src:"https://www.huayaopudong.com/static/logo.png",alt:"课程管理系统",className:"h-12"})})]}),(0,n.jsxs)("div",{className:"flex items-center gap-4",children:[E&&(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)(T.A,{className:"h-5 w-5 text-white/70 mr-2 hidden sm:inline"}),(0,n.jsx)("span",{className:"text-white font-medium truncate max-w-[100px] whitespace-nowrap",children:E.username||E.data&&E.data.name||"用户"})]}),(0,n.jsxs)("button",{onClick:x,style:{"--hover-bg":"var(--header-hover-bg)","--active-bg":"var(--header-active-bg)"},className:"flex items-center px-2 sm:px-4 py-2 text-white/85 hover:text-white rounded-lg transition-all duration-200 hover:bg-[var(--hover-bg)] active:bg-[var(--active-bg)]",children:[(0,n.jsx)(C.A,{className:"h-5 w-5 sm:mr-2"}),(0,n.jsx)("span",{className:"hidden sm:inline",children:"退出"})]})]})]})}),l&&(0,n.jsx)("div",{className:"fixed inset-0 z-20 modal-backdrop md:hidden",onClick:()=>c(!1)}),(0,n.jsxs)("div",{className:"flex h-[calc(100vh-4rem)]",children:[(0,n.jsx)("div",{className:"fixed md:static z-50 w-64 h-full transition-all duration-300 ease-in-out ".concat(l?"translate-x-0":"-translate-x-full md:translate-x-0"),style:{background:"var(--sidebar-bg)"},children:(0,n.jsxs)("nav",{className:"h-full overflow-y-auto scrollbar-thin scrollbar-thumb-white/20 scrollbar-track-transparent hover:scrollbar-thumb-white/30",children:[(0,n.jsx)("div",{className:"flex justify-end px-4 pt-4 md:hidden",children:(0,n.jsx)("button",{onClick:()=>c(!1),className:"text-white/80 hover:text-white",children:(0,n.jsx)(w.A,{className:"h-6 w-6"})})}),(0,n.jsx)("div",{className:"py-6 px-3",children:(0,n.jsx)("div",{className:"space-y-1",children:g.map(e=>{let t=_(e),a=e.children&&e.children.length>0,s=d===e.name;return(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsxs)("button",{onClick:()=>a?f(e.name):e.href&&r.push(e.href),className:"\n                          group flex w-full items-center justify-between px-3 py-2.5 text-sm font-medium rounded-lg\n                          transition-all duration-200 ease-in-out\n                          ".concat(t?"text-white bg-white/20":"text-white/90 hover:text-white hover:bg-white/10","\n                        "),children:[(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)(e.icon,{className:"\n                              mr-3 h-5 w-5 flex-shrink-0 transition-colors duration-200\n                              ".concat(t?"text-white":"text-white/70 group-hover:text-white","\n                            "),"aria-hidden":"true"}),e.name]}),a&&(0,n.jsx)(O.A,{className:"h-4 w-4 transition-transform duration-200 ".concat(s?"rotate-180":"")})]}),a&&s&&e.children&&(0,n.jsx)("div",{className:"ml-4 space-y-1 pt-1",children:e.children.map(e=>(0,n.jsxs)("button",{onClick:()=>e.href&&r.push(e.href),className:"\n                                group flex w-full items-center px-3 py-2 text-sm font-medium rounded-lg\n                                transition-all duration-200 ease-in-out\n                                ".concat(e.href&&I(e.href)?"text-white bg-white/20":"text-white/80 hover:text-white hover:bg-white/10","\n                              "),children:[(0,n.jsx)(e.icon,{className:"\n                                  mr-3 h-4 w-4 flex-shrink-0 transition-colors duration-200\n                                  ".concat(e.href&&I(e.href)?"text-white":"text-white/70 group-hover:text-white","\n                                "),"aria-hidden":"true"}),e.name]},e.name))})]},e.name)})})})]})}),(0,n.jsx)("div",{className:"flex-1 overflow-auto",children:(0,n.jsx)("div",{className:"max-w-7xl mx-auto p-2 sm:p-4 lg:p-8",children:t})})]})]})}var R=r(109);function P(e){let{children:t}=e,r=(0,s.usePathname)(),o=(0,s.useRouter)(),{user:l}=(0,i.A)(),{salesInfo:c,isLoading:d}=(0,R.OO)(),m=["/login","/403"].includes(r);return((0,a.useEffect)(()=>{var e;if(!l){m||o.push("/login");return}(null===(e=l.data)||void 0===e?void 0:e.type)!==4||d||(null==c?void 0:c.info_sign)!==0||"/my-profile"===r||o.push("/my-profile")},[l,m,o,r,c,d]),m)?t:l?(0,n.jsx)(V,{children:t}):null}var k=r(2459),L=r(8346),M=r.n(L);let D={enableApiDebugger:!1};var K=r(5594),B=r(376);let U=()=>{let[e,t]=(0,a.useState)(!1),[r,s]=(0,a.useState)([]),[i,o]=(0,a.useState)(""),[l,c]=(0,a.useState)("/api/"),[d,m]=(0,a.useState)("GET"),[u,h]=(0,a.useState)(""),[E,p]=(0,a.useState)([{key:"",value:""}]),[x,_]=(0,a.useState)([{key:"Authorization",value:""}]),[I,f]=(0,a.useState)(null),[g,b]=(0,a.useState)(!1),[v,N]=(0,a.useState)("");if((0,a.useEffect)(()=>{try{let e=localStorage.getItem("apiDebuggerTabs");if(e){let t=JSON.parse(e);s(t),t.length>0?(o(t[0].id),S(t[0])):y()}else y();let t=localStorage.getItem("token");t&&_(e=>e.map(e=>"Authorization"===e.key?(0,B._)((0,K._)({},e),{value:t}):e))}catch(e){console.error("加载保存的请求失败:",e),y()}},[]),(0,a.useEffect)(()=>{i&&r.length>0&&T()},[l,d,u,E,x,i]),!D.enableApiDebugger)return null;let y=()=>{let e="tab-".concat(Date.now()),t={id:e,name:"请求 ".concat(r.length+1),path:"/api/",method:"GET",requestBody:"",queryParams:[{key:"",value:""}],headerParams:[{key:"Authorization",value:""}],response:null,error:""};{let e=localStorage.getItem("token");e&&(t.headerParams[0].value=e)}let n=[...r,t];s(n),o(e),S(t),localStorage.setItem("apiDebuggerTabs",JSON.stringify(n.map(e=>(0,B._)((0,K._)({},e),{response:null,error:""}))))},w=e=>{T(),o(e);let t=r.find(t=>t.id===e);t&&S(t)},T=()=>{if(!i)return;let e=r.map(e=>e.id===i?(0,B._)((0,K._)({},e),{path:l,method:d,requestBody:u,queryParams:E,headerParams:x,response:I,error:v}):e);s(e),localStorage.setItem("apiDebuggerTabs",JSON.stringify(e.map(e=>(0,B._)((0,K._)({},e),{response:null,error:""}))))},S=e=>{c(e.path),m(e.method),h(e.requestBody),p(e.queryParams),_(e.headerParams),f(e.response),N(e.error)},A=(e,t)=>{if(t.stopPropagation(),r.length<=1)return;let n=r.filter(t=>t.id!==e);s(n),e===i&&n.length>0&&(o(n[0].id),S(n[0])),localStorage.setItem("apiDebuggerTabs",JSON.stringify(n.map(e=>(0,B._)((0,K._)({},e),{response:null,error:""}))))},W=e=>{let t=r.findIndex(t=>t.id===e);if(-1!==t){let e=prompt("请输入新的请求名称:",r[t].name);if(e&&e.trim()){let n=[...r];n[t]=(0,B._)((0,K._)({},n[t]),{name:e.trim()}),s(n),localStorage.setItem("apiDebuggerTabs",JSON.stringify(n.map(e=>(0,B._)((0,K._)({},e),{response:null,error:""}))))}}},j=(e,t,r)=>{let n=[...E];n[e][t]=r,p(n)},C=e=>{if(E.length>1){let t=[...E];t.splice(e,1),p(t)}},O=(e,t,r)=>{let n=[...x];n[e][t]=r,_(n)},J=e=>{if(x.length>1){let t=[...x];t.splice(e,1),_(t)}},V=()=>{let e=E.filter(e=>""!==e.key.trim());if(0===e.length)return l;let t=e.map(e=>"".concat(encodeURIComponent(e.key),"=").concat(encodeURIComponent(e.value))).join("&");return"".concat(l).concat(l.includes("?")?"&":"?").concat(t)},R=()=>{let e={"Content-Type":"application/json"};return x.filter(e=>""!==e.key.trim()).forEach(t=>{e[t.key]=t.value}),e},P=async()=>{try{let e;b(!0),N(""),f(null);let t=V(),n=R(),a={method:d,headers:n};if("GET"!==d&&u.trim())try{a.body=u}catch(e){N("请求体JSON格式错误"),b(!1);return}console.log("发送请求:",{url:t,method:d,headers:n,body:a.body});let o=await fetch(t,a),l=o.headers.get("content-type");e=l&&l.includes("application/json")?await o.json():await o.text();let c={status:o.status,statusText:o.statusText,headers:Object.fromEntries(o.headers.entries()),data:e};f(c);let m=r.map(e=>e.id===i?(0,B._)((0,K._)({},e),{response:c,error:""}):e);s(m),localStorage.setItem("apiDebuggerTabs",JSON.stringify(m.map(e=>(0,B._)((0,K._)({},e),{response:null,error:""}))))}catch(n){let e=n.message||"请求失败";N(e);let t=r.map(t=>t.id===i?(0,B._)((0,K._)({},t),{response:null,error:e}):t);s(t),localStorage.setItem("apiDebuggerTabs",JSON.stringify(t.map(e=>(0,B._)((0,K._)({},e),{response:null,error:""}))))}finally{b(!1)}};return(0,n.jsxs)("div",{className:"fixed bottom-5 right-5 z-50",children:[(0,n.jsx)("button",{onClick:()=>t(!0),className:"px-4 py-2 bg-blue-500 text-white border-none rounded cursor-pointer",children:"API 调试"}),e&&(0,n.jsxs)("div",{className:"fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white rounded-lg shadow-lg w-[800px] max-w-[90vw] max-h-[90vh] flex flex-col overflow-hidden",children:[(0,n.jsxs)("div",{className:"flex justify-between px-5 py-5 border-b border-gray-100",children:[(0,n.jsx)("h3",{className:"m-0",children:"API 调试"}),(0,n.jsx)("button",{onClick:()=>t(!1),className:"bg-transparent border-none cursor-pointer text-xl",children:"\xd7"})]}),(0,n.jsxs)("div",{className:"flex border-b border-gray-200 px-5 overflow-x-auto flex-shrink-0",children:[r.map(e=>(0,n.jsxs)("div",{onClick:()=>w(e.id),onDoubleClick:()=>W(e.id),className:"px-3 py-2 mr-1 cursor-pointer flex items-center min-w-[100px] justify-between whitespace-nowrap\n                  ".concat(e.id===i?"bg-gray-100 border border-gray-200 border-b-0 rounded-t-md":"border border-transparent border-b-0"),children:[(0,n.jsx)("span",{className:"max-w-[150px] overflow-hidden text-ellipsis",children:e.name}),(0,n.jsx)("button",{onClick:t=>A(e.id,t),className:"bg-transparent border-none cursor-pointer text-sm ml-2 px-1",children:"\xd7"})]},e.id)),(0,n.jsx)("button",{onClick:y,className:"px-3 py-2 bg-transparent border-none cursor-pointer text-xl leading-none",children:"+"})]}),(0,n.jsxs)("div",{className:"p-5 overflow-auto flex-1 max-h-[calc(90vh-120px)]",children:[(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("div",{className:"mb-2",children:"请求路径:"}),(0,n.jsx)("input",{type:"text",value:l,onChange:e=>c(e.target.value),className:"w-full p-2 border border-gray-300 rounded",placeholder:"/api/your-endpoint"})]}),(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("div",{className:"mb-2",children:"请求方法:"}),(0,n.jsxs)("select",{value:d,onChange:e=>m(e.target.value),className:"w-full p-2 border border-gray-300 rounded",children:[(0,n.jsx)("option",{value:"GET",children:"GET"}),(0,n.jsx)("option",{value:"POST",children:"POST"}),(0,n.jsx)("option",{value:"PUT",children:"PUT"}),(0,n.jsx)("option",{value:"DELETE",children:"DELETE"})]})]}),(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,n.jsx)("span",{children:"请求头:"}),(0,n.jsx)("button",{onClick:()=>{try{let e=localStorage.getItem("token");e&&_(t=>t.map(t=>"Authorization"===t.key?(0,B._)((0,K._)({},t),{value:e}):t))}catch(e){console.error("获取token失败:",e)}},className:"px-2 py-1 bg-gray-100 border border-gray-300 rounded text-xs cursor-pointer",children:"刷新Token"})]}),x.map((e,t)=>(0,n.jsxs)("div",{className:"flex gap-2 mb-2",children:[(0,n.jsx)("input",{type:"text",value:e.key,onChange:e=>O(t,"key",e.target.value),placeholder:"Header名",className:"flex-1 p-2 border border-gray-300 rounded"}),(0,n.jsx)("input",{type:"text",value:e.value,onChange:e=>O(t,"value",e.target.value),placeholder:"Header值",className:"flex-1 p-2 border border-gray-300 rounded"}),(0,n.jsx)("button",{onClick:()=>J(t),className:"p-2 border border-gray-300 rounded bg-white cursor-pointer",children:"删除"})]},t)),(0,n.jsx)("button",{onClick:()=>{_([...x,{key:"",value:""}])},className:"px-4 py-2 bg-white border border-gray-300 rounded cursor-pointer",children:"添加请求头"})]}),(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("div",{className:"mb-2",children:"Query 参数:"}),E.map((e,t)=>(0,n.jsxs)("div",{className:"flex gap-2 mb-2",children:[(0,n.jsx)("input",{type:"text",value:e.key,onChange:e=>j(t,"key",e.target.value),placeholder:"参数名",className:"flex-1 p-2 border border-gray-300 rounded"}),(0,n.jsx)("input",{type:"text",value:e.value,onChange:e=>j(t,"value",e.target.value),placeholder:"参数值",className:"flex-1 p-2 border border-gray-300 rounded"}),(0,n.jsx)("button",{onClick:()=>C(t),className:"p-2 border border-gray-300 rounded bg-white cursor-pointer",children:"删除"})]},t)),(0,n.jsx)("button",{onClick:()=>{p([...E,{key:"",value:""}])},className:"px-4 py-2 bg-white border border-gray-300 rounded cursor-pointer",children:"添加参数"})]}),"GET"!==d&&(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("div",{className:"mb-2",children:"请求体 (JSON):"}),(0,n.jsx)("textarea",{value:u,onChange:e=>h(e.target.value),className:"w-full h-[120px] p-2 border border-gray-300 rounded font-mono",placeholder:'{"key": "value"}'})]}),(0,n.jsx)("div",{className:"mb-4",children:(0,n.jsx)("button",{onClick:P,disabled:g,className:"px-4 py-2 bg-blue-500 text-white border-none rounded cursor-pointer ".concat(g?"opacity-70 cursor-not-allowed":""),children:g?"请求中...":"发送请求"})}),v&&(0,n.jsx)("div",{className:"p-3 bg-red-50 border border-red-200 rounded mb-4 text-red-600",children:v}),I&&(0,n.jsxs)("div",{className:"mt-4",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,n.jsxs)("div",{children:["响应状态: ",I.status," ",I.statusText]}),(0,n.jsx)("button",{onClick:()=>{if(I)try{let e="string"==typeof I.data?I.data:JSON.stringify(I.data,null,2);navigator.clipboard.writeText(e).then(()=>{alert("已复制到剪贴板")}).catch(e=>{console.error("复制失败:",e),alert("复制失败，请手动复制")})}catch(e){console.error("格式化响应数据失败:",e),alert("复制失败，请手动复制")}},className:"px-2 py-1 bg-gray-100 border border-gray-300 rounded text-xs cursor-pointer",children:"复制响应数据"})]}),(0,n.jsx)("div",{className:"mb-2",children:"响应数据:"}),(0,n.jsx)("pre",{className:"bg-gray-100 p-3 rounded overflow-auto max-h-[300px] font-mono",children:"string"==typeof I.data?I.data:JSON.stringify(I.data,null,2)})]})]})]})]})};function F(e){let{children:t}=e;return(0,n.jsxs)("html",{lang:"zh",children:[(0,n.jsxs)("head",{children:[(0,n.jsx)("title",{children:"课程管理系统"}),(0,n.jsx)("script",{defer:!0,src:"https://res.wx.qq.com/open/js/jweixin-1.6.0.js"}),(0,n.jsx)("meta",{name:"description",content:"课程管理系统"})]}),(0,n.jsxs)("body",{className:M().className,children:[(0,n.jsx)(i.O,{children:(0,n.jsx)(R.SF,{children:(0,n.jsx)(k.X,{children:(0,n.jsx)(P,{children:t})})})}),D.enableApiDebugger&&(0,n.jsx)(U,{})]})]})}},9385:(e,t,r)=>{"use strict";r.d(t,{J:()=>n});let n={VIEW_DASHBOARD:"view_dashboard",VIEW_SCHEDULE:"view_schedule",VIEW_LESSON_TABLE:"view_lesson_table",VIEW_PASTPAPER_TEXTBOOKS:"view_pastpaper_textbooks",VIEW_BOOK_LOCKER:"view_book_locker",VIEW_WARNINGS:"view_warnings",VIEW_CARD:"view_card",FILE_COMPLAINT:"file_complaint",EDIT_PROFILE:"edit_profile",MY_PROFILE:"my_profile",VIEW_WEEKEND_PLAN:"view_weekend_plan",VIEW_CERTIFICATE_APPLY:"view_certificate_apply",VIEW_EXIT_PERMIT:"view_exit_permit",VIEW_CLASS_SIGNUP:"view_class_signup",VIEW_SERVICE:"view_service",VIEW_LATE_CASHIN:"view_late_cashin",VIEW_REMARKING:"view_remarking",VIEW_EXAM_WITHDRAWAL:"view_exam_withdrawal",VIEW_SCORE_REPORT:"view_score_report",TEST_SCORE:"test_score",VIEW_TEXTBOOK:"view_textbook",VIEW_NOTIFICATION:"view_notification",VIEW_EXAM_SIGNUP:"view_exam_signup",MY_TEST:"my_test",INTERVIEW:"interview",VIEW_COMMITMENT:"view_commitment"}},9959:(e,t,r)=>{"use strict";r.d(t,{y:()=>a});var n=r(8508);let a={login:n.iD,logout:n.ri,getUserInfo:n.ug,getMyExams:n.hd,getAllExams:n.xV,signupExam:n.Oh,updateEdexcelNumber:n.L9,updateCieNumber:n.wW,getExamPayLink:n.mF,getStudentSalesInfo:n.e7,updateStudentSalesInfo:n.BE}}},e=>{var t=t=>e(e.s=t);e.O(0,[690,191,470,508,441,684,358],()=>t(5097)),_N_E=e.O()}]);
//# sourceMappingURL=layout-52b9c4f120aa43fc.js.map